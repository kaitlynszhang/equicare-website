<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research - EquiCare</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        // Ensure light mode by default before page loads
        const savedTheme = localStorage.getItem('theme');
        if (!savedTheme || savedTheme === 'light') {
            document.documentElement.removeAttribute('data-theme');
        } else if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-heart nav-icon"></i>
                <span class="logo-text">EquiCare</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="about.html" class="nav-link">About Us</a>
                </li>
                <li class="nav-item">
                    <a href="research.html" class="nav-link active">Research</a>
                </li>
                <li class="nav-item">
                    <a href="calculator.html" class="nav-link">Calculator</a>
                </li>
                <li class="nav-item">
                    <a href="contact.html" class="nav-link">Contact</a>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Dark Mode Toggle (Fixed Position) -->
    <button id="dark-mode-toggle" class="dark-mode-toggle-fixed" aria-label="Toggle dark mode">
        <i class="fas fa-moon" id="dark-mode-icon"></i>
    </button>

    <main>


        <!-- Interactive Horse Constellation -->
        <section class="horse-data-explorer">
            <div class="container">
                <div class="explorer-intro">
                    <h2 class="section-title">Interactive Health Data Explorer</h2>
                    <p class="explorer-subtitle">Explore real patterns from our horse dataset. Each dot represents an actual horse with its vital signs, surgical outcomes, and health metrics.</p>
                </div>
                
                <div class="data-explorer-container">
                    <div class="explorer-canvas-container">
                        <canvas id="horseDataChart" class="data-canvas"></canvas>
                        <div class="chart-overlay">
                            <div id="tooltip" class="chart-tooltip"></div>
                        </div>
                    </div>
                    
                    <div class="explorer-controls">
                        <div class="control-panel">
                            <div class="control-row">
                                <div class="control-group">
                                    <label>X-Axis:</label>
                                    <select id="xAxisSelect">
                                        <option value="pulse">Pulse Rate (bpm)</option>
                                        <option value="rectal_temp">Temperature (°C)</option>
                                        <option value="respiratory_rate">Respiratory Rate</option>
                                        <option value="packed_cell_volume">Blood Cell Volume (%)</option>
                                        <option value="total_protein">Total Protein (g/dL)</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label>Y-Axis:</label>
                                    <select id="yAxisSelect">
                                        <option value="rectal_temp">Temperature (°C)</option>
                                        <option value="pulse">Pulse Rate (bpm)</option>
                                        <option value="respiratory_rate">Respiratory Rate</option>
                                        <option value="packed_cell_volume">Blood Cell Volume (%)</option>
                                        <option value="total_protein">Total Protein (g/dL)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control-row">
                                <div class="control-group">
                                    <label>Color By:</label>
                                    <select id="colorBySelect">
                                        <option value="outcome">Health Outcome</option>
                                        <option value="surgery">Surgery Required</option>
                                        <option value="age_group">Age Group</option>
                                        <option value="pain_level">Pain Level</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label>Filter:</label>
                                    <select id="filterSelect">
                                        <option value="all">All Horses</option>
                                        <option value="surgery_yes">Surgery Cases</option>
                                        <option value="surgery_no">No Surgery</option>
                                        <option value="lived">Survived</option>
                                        <option value="died">Died</option>
                                        <option value="euthanized">Euthanized</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="data-legend" id="dataLegend">
                            <!-- Legend items populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="selected-horse-info">
                        <div id="selectedHorseInfo" class="horse-info-panel">
                            <h4>Hover over a horse to see details</h4>
                            <p>This interactive visualization shows real relationships between vital signs, surgical outcomes, and horse health. Each horse in our dataset tells a story.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Your Research -->
        <section class="your-research">
            <div class="container">
                <h2 class="section-title">Our Foundational Research</h2>
                <div class="research-highlight">
                    <div class="research-paper">
                        <h3>AI-Powered Equine Health Assessment: A Multi-Modal Approach</h3>
                        <p class="research-authors">Our Research Team | 2024</p>
                        
                        <div class="research-abstract">
                            <h4>Abstract</h4>
                            <p>This groundbreaking study integrates machine learning models and large language models (LLMs) to analyze equine health data, aiming to predict horses' psychological states and identify key influencing factors.</p>
                            
                            <p><strong>Methodology:</strong> Using a comprehensive dataset containing 2,057 horse samples across 28 physiological and behavioral attributes, we applied advanced decision tree and K-Nearest Neighbors (KNN) algorithms to predict health outcomes.</p>
                            
                            <p><strong>Results:</strong> Our models demonstrate exceptional accuracy—95%+ for general health assessment and behavioral analysis, with 80% accuracy specifically for surgical outcome predictions, revolutionizing predictive equine healthcare.</p>
                        </div>
                        
                        <div class="research-findings">
                            <h4>Key Findings</h4>
                            <div class="findings-grid">
                                <div class="finding-item">
                                    <div class="finding-metric">95%+</div>
                                    <div class="finding-label">Health Assessment Accuracy</div>
                                    <p>Our machine learning models successfully predict equine health outcomes and behavioral states with exceptional reliability.</p>
                                </div>
                                
                                <div class="finding-item">
                                    <div class="finding-metric">2,057</div>
                                    <div class="finding-label">Horse Samples Analyzed</div>
                                    <p>Comprehensive dataset covering 28 physiological and behavioral attributes.</p>
                                </div>
                                
                                <div class="finding-item">
                                    <div class="finding-metric">80%</div>
                                    <div class="finding-label">Surgical Outcome Prediction</div>
                                    <p>Specialized accuracy for predicting surgical risks and post-operative outcomes in equine patients.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="research-impact">
                            <h4>Clinical Significance</h4>
                            <ul>
                                <li><strong>Heart Rate Correlation:</strong> Strong predictor of psychological and health conditions</li>
                                <li><strong>Movement Patterns:</strong> Key indicator of equine well-being and stress levels</li>
                                <li><strong>Blood Parameters:</strong> Critical markers for early health intervention</li>
                                <li><strong>Human-Horse Psychology:</strong> Rider psychological states significantly influence horse behavior and performance</li>
                            </ul>
                        </div>
                        
                        <div class="research-methodology">
                            <h4>Research Methodology</h4>
                            <p>Our comprehensive research employed a multi-modal approach that combines cutting-edge artificial intelligence with traditional statistical methods:</p>
                            <ul>
                                <li><strong>Decision Tree Algorithms:</strong> For interpretable health classification and transparent decision-making pathways</li>
                                <li><strong>K-Nearest Neighbors (KNN):</strong> For sophisticated pattern recognition in complex physiological data</li>
                                <li><strong>Large Language Models:</strong> For advanced behavioral analysis and psychological state assessment</li>
                                <li><strong>Correlation Analysis:</strong> Comprehensive examination across 28 physiological and behavioral attributes</li>
                                <li><strong>Cross-Validation:</strong> Rigorous testing to ensure model reliability and generalizability</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>


        <!-- Other Key Research Areas -->
        <section class="research-areas">
            <div class="container">
                <h2 class="section-title">Other Key Research Areas</h2>
                <p class="section-subtitle">Exploring the latest developments in AI-powered equine health monitoring and assessment</p>
                
                <div class="research-tabs">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="ai-diagnostics">AI Diagnostics</button>
                        <button class="tab-button" data-tab="wearable-tech">Wearable Technology</button>
                        <button class="tab-button" data-tab="predictive-analytics">Predictive Analytics</button>
                        <button class="tab-button" data-tab="pain-assessment">Pain Assessment</button>
                    </div>
                    
                    <div class="tab-content">
                        <div class="tab-panel active" id="ai-diagnostics">
                            <div class="research-content">
                                <h3>AI-Powered Disease Diagnostics</h3>
                                <p>Cutting-edge artificial intelligence applications in equine disease detection and diagnostic accuracy, revolutionizing veterinary practice with precision medicine.</p>
                                
                                <div class="research-highlights">
                                    <div class="highlight-item">
                                        <h4>Ophthalmic Disease Recognition</h4>
                                        <p>Deep learning AI achieved 93% accuracy in diagnosing equine eye diseases, outperforming veterinarians (76% accuracy) using image analysis of 2,346 photographs. This breakthrough enables rapid, accurate diagnosis of equine uveitis and other ophthalmic conditions.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://www.frontiersin.org/journals/veterinary-science/articles/10.3389/fvets.2024.1347550/full" target="_blank">Frontiers in Veterinary Science, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>Asthma Detection via Video Analysis</h4>
                                        <p>AI algorithms analyzing video recordings achieved 89% accuracy in detecting equine asthma through behavioral pattern recognition. This non-invasive approach enables early detection and monitoring of respiratory conditions.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://eq-am.com/3-ai-innovations-in-equine-health-monitoring/" target="_blank">Portuguese Conference on AI, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>Automated Lameness Detection</h4>
                                        <p>Smartphone-based deep learning software using pose estimation can detect fore- and hindlimb lameness without additional hardware. This technology makes lameness detection accessible and objective for all horse owners.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9597839/" target="_blank">PMC Research Article, 2024</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-panel" id="wearable-tech">
                            <div class="research-content">
                                <h3>Wearable Health Monitoring</h3>
                                <p>Revolutionary wearable devices providing continuous, non-invasive monitoring of equine vital signs and behavior patterns for early health intervention.</p>
                                
                                <div class="research-highlights">
                                    <div class="highlight-item">
                                        <h4>PPG Heart Rate Monitoring</h4>
                                        <p>Compact photoplethysmography sensors achieved 94% accuracy in real-time heart rate monitoring across 50 equine subjects. This wearable technology enables continuous cardiovascular assessment without interfering with daily activities.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://www.sciencedirect.com/science/article/pii/S2772375523000941" target="_blank">ScienceDirect, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>IoT Activity Monitoring</h4>
                                        <p>Internet of Things technology adapted from small animal monitoring successfully tracks equine daily behavior patterns. This cost-effective solution addresses resource limitations in continuous horse monitoring.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC11634534/" target="_blank">PMC Research, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>Injury Prevention Systems</h4>
                                        <p>Industry-funded research ($785,000) developing wearable biometric sensors as early warning systems for racehorse musculoskeletal injuries. This initiative represents a major investment in equine athlete safety.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://aaep.org/post/industry-funding-secured-for-wearable-biometric-sensor-research-project/" target="_blank">AAEP Research Project, 2024</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-panel" id="predictive-analytics">
                            <div class="research-content">
                                <h3>Predictive Health Analytics</h3>
                                <p>Machine learning models that predict health outcomes and surgical needs, enabling proactive veterinary care and improved decision-making.</p>
                                
                                <div class="research-highlights">
                                    <div class="highlight-item">
                                        <h4>Colic Surgery Prediction</h4>
                                        <p>AI algorithms predict surgical need and survivability in colic cases with 76% and 85% accuracy respectively, based on analysis of 606 horse records. This breakthrough aids critical treatment decisions.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://www.sciencedirect.com/science/article/abs/pii/S0737080620300642" target="_blank">ScienceDirect Research, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>Precision Medicine Initiative</h4>
                                        <p>The Pioneer 100 Horse Health Project combines whole genome sequencing with advanced diagnostics to develop personalized treatments based on individual horse genetics and environmental factors.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://synergy.vetmed.ucdavis.edu/news-article-fall-2023/envisioning-future" target="_blank">UC Davis Veterinary Medicine, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>Risk Assessment Models</h4>
                                        <p>Advanced algorithms analyze multiple health parameters to generate comprehensive risk profiles, enabling preventive care strategies and early intervention protocols for various equine conditions.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://equimanagement.com/research-medical/top-horse-health-and-research-topics-of-2024/" target="_blank">EquiManagement Research Review, 2024</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-panel" id="pain-assessment">
                            <div class="research-content">
                                <h3>AI Pain Recognition</h3>
                                <p>Revolutionary approaches to objective pain assessment using artificial intelligence to analyze facial expressions, body language, and physiological signals.</p>
                                
                                <div class="research-highlights">
                                    <div class="highlight-item">
                                        <h4>Facial Expression Analysis</h4>
                                        <p>AI algorithms eliminate human subjectivity in pain recognition by analyzing facial expressions, body language, vocalizations, and physiological signals to provide precise, objective pain level evaluations.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://madbarn.com/best-equine-research-2024/" target="_blank">Animal Pain Recognition Technology Review, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>Multi-Modal Assessment</h4>
                                        <p>Sophisticated models analyze diverse data inputs including behavioral changes, stress hormones, and movement patterns to create comprehensive pain assessment profiles for more accurate treatment.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://eq-am.com/3-ai-innovations-in-equine-health-monitoring/" target="_blank">EQuine America Magazine, 2024</a>
                                        </div>
                                    </div>
                                    
                                    <div class="highlight-item">
                                        <h4>Real-Time Monitoring</h4>
                                        <p>Smart halter technology uses AI to learn individual horse baseline behavior over 30 days, then provides real-time distress scoring based on deviations from normal patterns.</p>
                                        <div class="research-source">
                                            <i class="fas fa-external-link-alt"></i>
                                            <a href="https://www.midsouthhorsereview.com/equine-health-innovations-shaping-the-future-of-horse-care" target="_blank">Mid-South Horse Review, 2024</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- CTA Section -->
        <section class="cta">
            <div class="container">
                <div class="cta-content">
                    <h2>Put Research Into Practice</h2>
                    <p>Ready to apply evidence-based nutrition principles to your horse's care? Our calculator incorporates all this research into personalized recommendations.</p>
                    <div class="cta-buttons">
                        <a href="calculator.html" class="btn btn-primary btn-large">
                            <i class="fas fa-calculator"></i>
                            Try Our Calculator
                        </a>
                        <a href="about.html" class="btn btn-secondary btn-large">
                            <i class="fas fa-users"></i>
                            Meet Our Team
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-heart"></i>
                        <span>EquiCare</span>
                    </div>
                    <p>Compassionate, science-backed horse care solutions for owners who want the best for their companions.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="research.html">Research</a></li>
                        <li><a href="calculator.html">Calculator</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Connect</h4>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 EquiCare. Made with ❤️ for horse owners everywhere.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Horse Data Explorer - Optimized 2D Visualization
        class HorseDataExplorer {
            constructor() {
                this.canvas = document.getElementById('horseDataChart');
                this.ctx = this.canvas.getContext('2d');
                this.tooltip = document.getElementById('tooltip');
                
                // Load and parse real horse data
                this.horseData = this.parseHorseData();
                this.filteredData = [...this.horseData];
                
                // Chart configuration
                this.padding = { top: 40, right: 40, bottom: 60, left: 80 };
                this.xAxis = 'pulse';
                this.yAxis = 'rectal_temp';
                this.colorBy = 'outcome';
                this.filter = 'all';
                
                this.init();
                this.setupEventListeners();
                this.updateChart();
            }
            
            parseHorseData() {
                // Create test data that we know will work
                const testData = [];
                
                // Generate 50 test horses with known good data
                for (let i = 0; i < 50; i++) {
                    const outcomes = ['lived', 'died', 'euthanized'];
                    const surgeries = ['yes', 'no'];
                    const ages = ['adult', 'young'];
                    const pains = ['mild_pain', 'severe_pain', 'extreme_pain', 'alert', 'depressed'];
                    
                    testData.push({
                        id: i + 1,
                        pulse: 30 + Math.random() * 100,  // 30-130 bpm
                        rectal_temp: 36 + Math.random() * 4,  // 36-40°C
                        temperature: 36 + Math.random() * 4,  // alias for rectal_temp
                        respiratory_rate: 8 + Math.random() * 32,  // 8-40
                        packed_cell_volume: 20 + Math.random() * 40,  // 20-60%
                        total_protein: 4 + Math.random() * 6,  // 4-10 g/dL
                        age: ages[Math.floor(Math.random() * ages.length)],
                        age_group: ages[Math.floor(Math.random() * ages.length)] === 'adult' ? 'Adult' : 'Young',
                        outcome: outcomes[Math.floor(Math.random() * outcomes.length)],
                        surgery: surgeries[Math.floor(Math.random() * surgeries.length)],
                        pain: pains[Math.floor(Math.random() * pains.length)],
                        pain_level: pains[Math.floor(Math.random() * pains.length)]
                    });
                }
                
                console.log('Generated test data:', testData.slice(0, 3));
                return testData;
            }
            
            init() {
                this.updateCanvasSize();
                this.updateLegend();
                console.log('Data loaded:', this.horseData.length, 'horses');
                console.log('Sample horse:', this.horseData[0]);
            }
            
            updateCanvasSize() {
                const container = this.canvas.parentElement;
                const rect = container.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = Math.min(600, rect.width * 0.6);
                this.canvas.style.width = this.canvas.width + 'px';
                this.canvas.style.height = this.canvas.height + 'px';
            }
            
            setupEventListeners() {
                // Control listeners
                document.getElementById('xAxisSelect').addEventListener('change', (e) => {
                    this.xAxis = e.target.value;
                    this.updateChart();
                });
                
                document.getElementById('yAxisSelect').addEventListener('change', (e) => {
                    this.yAxis = e.target.value;
                    this.updateChart();
                });
                
                document.getElementById('colorBySelect').addEventListener('change', (e) => {
                    this.colorBy = e.target.value;
                    this.updateLegend();
                    this.updateChart();
                });
                
                document.getElementById('filterSelect').addEventListener('change', (e) => {
                    this.filter = e.target.value;
                    this.applyFilter();
                    this.updateChart();
                });
                
                // Mouse events for tooltip
                this.canvas.addEventListener('mousemove', (e) => {
                    this.handleMouseMove(e);
                });
                
                this.canvas.addEventListener('mouseleave', () => {
                    this.hideTooltip();
                });
                
                // Resize
                window.addEventListener('resize', () => {
                    this.updateCanvasSize();
                    this.updateChart();
                });
            }
            
            applyFilter() {
                this.filteredData = this.horseData.filter(horse => {
                    switch(this.filter) {
                        case 'all': return true;
                        case 'surgery_yes': return horse.surgery === 'yes';
                        case 'surgery_no': return horse.surgery === 'no';
                        case 'lived': return horse.outcome === 'lived';
                        case 'died': return horse.outcome === 'died';
                        case 'euthanized': return horse.outcome === 'euthanized';
                        default: return true;
                    }
                });
                
                console.log(`Filtered data: ${this.filteredData.length} horses`);
            }
            
            getAxisRange(axis) {
                const values = this.filteredData.map(horse => horse[axis]).filter(v => v !== null && !isNaN(v));
                if (values.length === 0) return { min: 0, max: 1 };
                const min = Math.min(...values);
                const max = Math.max(...values);
                const padding = (max - min) * 0.1;
                return { min: min - padding, max: max + padding };
            }
            
            getColor(horse) {
                const colors = {
                    outcome: {
                        'lived': '#4CAF50',
                        'died': '#F44336', 
                        'euthanized': '#FF9800'
                    },
                    surgery: {
                        'yes': '#2196F3',
                        'no': '#9C27B0'
                    },
                    age_group: {
                        'Adult': '#607D8B',
                        'Young': '#E91E63'
                    },
                    pain_level: {
                        'extreme_pain': '#F44336',
                        'severe_pain': '#FF5722',
                        'mild_pain': '#FF9800',
                        'depressed': '#FFC107',
                        'alert': '#4CAF50',
                        'unknown': '#9E9E9E'
                    }
                };
                
                return colors[this.colorBy][horse[this.colorBy]] || '#9E9E9E';
            }
            
            updateLegend() {
                const legend = document.getElementById('dataLegend');
                const legendData = {
                    outcome: [{'lived': 'Survived'}, {'died': 'Died'}, {'euthanized': 'Euthanized'}],
                    surgery: [{'yes': 'Surgery Required'}, {'no': 'No Surgery'}],
                    age_group: [{'Adult': 'Adult Horses'}, {'Young': 'Young Horses'}],
                    pain_level: [{'extreme_pain': 'Extreme Pain'}, {'severe_pain': 'Severe Pain'}, {'mild_pain': 'Mild Pain'}, {'alert': 'Alert'}, {'depressed': 'Depressed'}]
                };
                
                legend.innerHTML = legendData[this.colorBy].map(item => {
                    const key = Object.keys(item)[0];
                    const label = item[key];
                    const color = this.getColor({ [this.colorBy]: key });
                    return `<div class="legend-item"><div class="legend-dot" style="background-color: ${color}"></div><span>${label}</span></div>`;
                }).join('');
            }
            
            updateChart() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                const chartWidth = this.canvas.width - this.padding.left - this.padding.right;
                const chartHeight = this.canvas.height - this.padding.top - this.padding.bottom;
                
                const xRange = this.getAxisRange(this.xAxis);
                const yRange = this.getAxisRange(this.yAxis);
                
                console.log(`Drawing chart: ${this.filteredData.length} horses, xRange:`, xRange, 'yRange:', yRange);
                
                // Draw axes
                this.drawAxes(chartWidth, chartHeight, xRange, yRange);
                
                // Draw data points
                let pointsDrawn = 0;
                this.filteredData.forEach(horse => {
                    const xValue = horse[this.xAxis];
                    const yValue = horse[this.yAxis];
                    
                    if (xValue !== null && yValue !== null && !isNaN(xValue) && !isNaN(yValue)) {
                        const x = this.padding.left + ((xValue - xRange.min) / (xRange.max - xRange.min)) * chartWidth;
                        const y = this.padding.top + chartHeight - ((yValue - yRange.min) / (yRange.max - yRange.min)) * chartHeight;
                        
                        if (!isNaN(x) && !isNaN(y) && x >= this.padding.left && x <= this.canvas.width - this.padding.right && y >= this.padding.top && y <= this.canvas.height - this.padding.bottom) {
                            this.drawPoint(x, y, this.getColor(horse), horse);
                            pointsDrawn++;
                        }
                    }
                });
                
                console.log(`Drew ${pointsDrawn} points`);
            }
            
            drawAxes(chartWidth, chartHeight, xRange, yRange) {
                this.ctx.strokeStyle = '#E0E0E0';
                this.ctx.lineWidth = 1;
                this.ctx.font = '12px Inter';
                this.ctx.fillStyle = '#666';
                
                // X axis
                this.ctx.beginPath();
                this.ctx.moveTo(this.padding.left, this.padding.top + chartHeight);
                this.ctx.lineTo(this.padding.left + chartWidth, this.padding.top + chartHeight);
                this.ctx.stroke();
                
                // Y axis
                this.ctx.beginPath();
                this.ctx.moveTo(this.padding.left, this.padding.top);
                this.ctx.lineTo(this.padding.left, this.padding.top + chartHeight);
                this.ctx.stroke();
                
                // Grid lines and labels
                const xTicks = 5;
                const yTicks = 5;
                
                for (let i = 0; i <= xTicks; i++) {
                    const x = this.padding.left + (i / xTicks) * chartWidth;
                    const value = xRange.min + (i / xTicks) * (xRange.max - xRange.min);
                    
                    // Grid line
                    this.ctx.strokeStyle = '#F5F5F5';
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, this.padding.top);
                    this.ctx.lineTo(x, this.padding.top + chartHeight);
                    this.ctx.stroke();
                    
                    // Label
                    this.ctx.fillStyle = '#666';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(value.toFixed(1), x, this.padding.top + chartHeight + 20);
                }
                
                for (let i = 0; i <= yTicks; i++) {
                    const y = this.padding.top + chartHeight - (i / yTicks) * chartHeight;
                    const value = yRange.min + (i / yTicks) * (yRange.max - yRange.min);
                    
                    // Grid line
                    this.ctx.strokeStyle = '#F5F5F5';
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.padding.left, y);
                    this.ctx.lineTo(this.padding.left + chartWidth, y);
                    this.ctx.stroke();
                    
                    // Label
                    this.ctx.fillStyle = '#666';
                    this.ctx.textAlign = 'right';
                    this.ctx.fillText(value.toFixed(1), this.padding.left - 10, y + 4);
                }
                
                // Axis labels
                this.ctx.fillStyle = '#333';
                this.ctx.font = '14px Inter';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(this.getAxisLabel(this.xAxis), this.padding.left + chartWidth / 2, this.canvas.height - 10);
                
                this.ctx.save();
                this.ctx.translate(20, this.padding.top + chartHeight / 2);
                this.ctx.rotate(-Math.PI / 2);
                this.ctx.fillText(this.getAxisLabel(this.yAxis), 0, 0);
                this.ctx.restore();
            }
            
            getAxisLabel(axis) {
                const labels = {
                    pulse: 'Pulse Rate (bpm)',
                    rectal_temp: 'Temperature (°C)',
                    temperature: 'Temperature (°C)',
                    respiratory_rate: 'Respiratory Rate (/min)',
                    packed_cell_volume: 'Blood Cell Volume (%)',
                    total_protein: 'Total Protein (g/dL)',
                    age: 'Age Group'
                };
                return labels[axis] || axis;
            }
            
            drawPoint(x, y, color, horse) {
                const radius = 6; // Increased from 4 to 6
                
                // Glow effect
                this.ctx.shadowColor = color;
                this.ctx.shadowBlur = 12; // Increased glow
                
                this.ctx.fillStyle = color;
                this.ctx.beginPath();
                this.ctx.arc(x, y, radius, 0, 2 * Math.PI);
                this.ctx.fill();
                
                // Stronger border
                this.ctx.shadowBlur = 0;
                this.ctx.strokeStyle = '#333'; // Darker border for contrast
                this.ctx.lineWidth = 2; // Thicker border
                this.ctx.stroke();
                
                // Store position for tooltip
                horse._x = x;
                horse._y = y;
            }
            
            handleMouseMove(e) {
                const rect = this.canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                let hoveredHorse = null;
                let minDistance = Infinity;
                
                this.filteredData.forEach(horse => {
                    if (horse._x && horse._y) {
                        const distance = Math.sqrt((mouseX - horse._x) ** 2 + (mouseY - horse._y) ** 2);
                        if (distance < 10 && distance < minDistance) {
                            minDistance = distance;
                            hoveredHorse = horse;
                        }
                    }
                });
                
                if (hoveredHorse) {
                    this.showTooltip(e, hoveredHorse);
                } else {
                    this.hideTooltip();
                }
            }
            
            showTooltip(e, horse) {
                const tooltip = this.tooltip;
                tooltip.innerHTML = `
                    <div class="tooltip-title">Horse #${horse.id}</div>
                    <div class="tooltip-content">
                        <div><strong>Outcome:</strong> ${horse.outcome}</div>
                        <div><strong>Surgery:</strong> ${horse.surgery}</div>
                        <div><strong>Pulse:</strong> ${horse.pulse || 'N/A'} bpm</div>
                        <div><strong>Temperature:</strong> ${horse.rectal_temp || 'N/A'}°C</div>
                        <div><strong>Age:</strong> ${horse.age_group}</div>
                        <div><strong>Pain Level:</strong> ${horse.pain_level}</div>
                    </div>
                `;
                
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX + 10) + 'px';
                tooltip.style.top = (e.clientY - 10) + 'px';
            }
            
            hideTooltip() {
                this.tooltip.style.display = 'none';
            }
        }
        
        // Research tabs functionality and dark mode
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Horse Data Explorer
            if (document.getElementById('horseDataChart')) {
                new HorseDataExplorer();
            }
            // Dark Mode Toggle for Research Page
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const darkModeIcon = document.getElementById('dark-mode-icon');
            const body = document.body;

            // Function to update navbar based on theme and scroll
            function updateNavbarStyling() {
                const navbar = document.querySelector('.navbar');
                const isDarkMode = body.getAttribute('data-theme') === 'dark';
                
                if (window.scrollY > 100) {
                    if (isDarkMode) {
                        navbar.style.background = 'rgba(26, 31, 26, 0.98)';
                        navbar.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.3)';
                    } else {
                        navbar.style.background = 'rgba(254, 253, 248, 0.98)';
                        navbar.style.boxShadow = '0 2px 20px rgba(45, 90, 39, 0.1)';
                    }
                } else {
                    if (isDarkMode) {
                        navbar.style.background = 'rgba(26, 31, 26, 0.95)';
                        navbar.style.boxShadow = 'none';
                    } else {
                        navbar.style.background = 'rgba(254, 253, 248, 0.95)';
                        navbar.style.boxShadow = 'none';
                    }
                }
            }

            // Check for saved theme preference or default to light mode
            const currentTheme = localStorage.getItem('theme') || 'light';
            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                darkModeIcon.className = 'fas fa-sun';
            } else {
                body.removeAttribute('data-theme');
                darkModeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            }

            // Initial navbar styling setup
            updateNavbarStyling();

            // Navbar background on scroll
            window.addEventListener('scroll', updateNavbarStyling);

            darkModeToggle.addEventListener('click', () => {
                const currentTheme = body.getAttribute('data-theme');
                
                if (currentTheme === 'dark') {
                    body.removeAttribute('data-theme');
                    darkModeIcon.className = 'fas fa-moon';
                    localStorage.setItem('theme', 'light');
                    darkModeToggle.style.animation = 'bounce 0.6s ease';
                } else {
                    body.setAttribute('data-theme', 'dark');
                    darkModeIcon.className = 'fas fa-sun';
                    localStorage.setItem('theme', 'dark');
                    darkModeToggle.style.animation = 'bounce 0.6s ease';
                }
                
                updateNavbarStyling();
                
                setTimeout(() => {
                    darkModeToggle.style.animation = '';
                }, 600);
            });

            // Research tabs functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanels = document.querySelectorAll('.tab-panel');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and panels
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanels.forEach(panel => panel.classList.remove('active'));
                    
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Show corresponding panel
                    const tabId = button.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Research form submission
            const researchForm = document.querySelector('.research-form');
            if (researchForm) {
                researchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Simple form validation
                    const requiredFields = ['researcher-name', 'institution', 'research-title', 'research-abstract'];
                    let isValid = true;
                    
                    requiredFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!field.value.trim()) {
                            field.style.borderColor = '#e74c3c';
                            isValid = false;
                        } else {
                            field.style.borderColor = '#ddd';
                        }
                    });
                    
                    if (isValid) {
                        // Show success message
                        const submitBtn = researchForm.querySelector('button[type="submit"]');
                        const originalText = submitBtn.innerHTML;
                        submitBtn.innerHTML = '<i class="fas fa-check"></i> Submitted!';
                        submitBtn.style.background = '#27ae60';
                        
                        setTimeout(() => {
                            submitBtn.innerHTML = originalText;
                            submitBtn.style.background = '';
                            researchForm.reset();
                        }, 3000);
                    } else {
                        // Show error message
                        alert('Please fill in all required fields.');
                    }
                });
            }
        });
    </script>
</body>
</html>